```{r  include = FALSE}
library(tidyverse)
library(papaja)
library(here)
source(here('scripts','helpers.R'))
source(here('scripts','krippendorff_alpha.R'))
source(here('scripts','load_data.R'))
```

```{r demographics, echo=FALSE}
COLNAMES = c('', 'High OC FTF','TD FTF', 'TD Online (He)', 'TD Online (En)')

demographics_df = data.frame(
  X1 = c('N', 'Female N', 'Mean age (SD)', 'Anxiety Measure', 'Anxiety Score (SD)'),
  X2 = c(ocd.N, format_count_percentage(ocd.femaleN, ocd.N),  format_mean_sd(ocd.age.mean, ocd.age.sd), 'OCI-R', format_mean_sd(ocd.ocir.mean, ocd.ocir.sd)),
  X3 = c(sticsa.N, format_count_percentage(sticsa.femaleN, sticsa.N), format_mean_sd(sticsa.age.mean, sticsa.age.sd), 'TICSA', format_mean_sd(sticsa.sticsa.mean,sticsa.sticsa.sd)),
  X4 = c(online.N, '--', '--', 'TICSA', format_mean_sd(online.sticsa.mean,online.sticsa.sd)),
  X5 = c(wet.N, format_count_percentage(wet.femaleN, wet.N), format_mean_sd(wet.age.mean, wet.age.sd), 'OASIS', format_mean_sd(wet.oasis.mean,wet.oasis.sd))
)

demographics_df %>%
  apa_table(
    caption = 'Demographics',
    col.names = COLNAMES,
    col_spanners = list( "Interview" = 2:3, "Self-administered" = 4:5),
    note = 'OC - obsessive compulsive, FTF - face to face, TD - Transdiagnostic'
  )
```



## Methods: Experiment 1

Experiment 1 aimed to evaluate the feasibility and potential utility of the face to face CTSI for identifying core threats among individuals exhibiting high levels of obsessive-compulsive (OC) symptoms.

### Participants

Participants were drawn from a pre-existing database of individuals who had previously consented to participate in research and completed the OCI-R.
A research assistant contacted eligible participants and obtained informed consent.
Demographic characteristics are presented in Table \@ref(tab:demographics).
The median OCI-R score (`r ocd.ocir.median`) placed the majority of participants well within the severe range of obsessive-compulsive symptoms [@abramovitchSeverityBenchmarksContemporary2020].
Moreover, `r ocd.diamondN` participants, comprising `r apa_percentage(ocd.diamondN/ocd.N)` of the sample, met diagnostic criteria for obsessive-compulsive disorder (OCD) based on the DIAMOND interview.

### Procedure

Participants completed a series of questionnaires followed by a semi-structured interview conducted via Zoom, lasting between 45 minutes and two hours.
The interview included the OCD module of the DIAMOND and the CTSI.
The CTSI was used to identify core threats underlying two compulsions (proximal threats).
To enhance variability, the compulsions were chosen to be as dissimilar as possible (e.g., a cleaning compulsion versus a checking compulsion).
Interviewers explored participants' perceptions of what would occur if ritualistic behaviors were not performed.
Participants were compensated with approximately \$10 per hour or course credit, depending on their preference.

### Measures

The face-to-face CTSI was employed to identify proximal and core threats.
While three independent judges initially scored each threat, inter-rater reliability was insufficient.
To address this, a consensus score was used for subsequent analyses.
This approach informed the development of enhanced training protocols, which improved reliability in later experiments.
Despite initial limitations, the consensus scores are considered valid for the purposes of this study.

**Obsessive Compulsive Inventory Revised [OCIR\; @foaObsessiveCompulsiveInventoryDevelopment2002]**:
The OCI-R is an 18-item self-report measure assessing the distress associated with obsessive-compulsive symptoms using a Likert scale (0–4).
It has demonstrated strong psychometric properties across clinical and non-clinical populations [@huppertOCIRValidationSubscales2007; @foaObsessiveCompulsiveInventoryDevelopment2002].
In this sample, the OCI-R exhibited high internal consistency, with an omega coefficient of `r ocd.ocir.omega`, supporting its reliability as a measure of OCD symptom severity.

**Diagnostic Interview for Anxiety, Mood, and OCD and Related Neuropsychiatric Disorders [DIAMOND\; @tolinPsychometricPropertiesStructured2018]**:
The DIAMOND is a semi-structured diagnostic interview developed to diagnose DSM-5 psychiatric disorders with robust psychometric properties.
For this study, only the OCD section was administered to confirm OCD diagnoses.
The DIAMOND has consistently demonstrated excellent inter-rater reliability, test-retest reliability, and strong validity metrics [@tolinPsychometricPropertiesStructured2018].

## Methods: Experiment 2

Experiment 2 aimed to build on the findings of Experiment 1 by evaluating a transdiagnostic population with elevated anxiety symptoms.
A central objective was to assess the test-retest reliability and inter-rater reliability of the CTSI.

### Participants and Procedure

Participants were recruited from a pre-existing database of individuals who had previously consented to participate in research and completed the TICSA.
A research assistant contacted eligible participants and obtained informed consent.
Full demographic details are presented in Table \@ref(tab:demographics).

Participants completed the CTSI via Zoom in two sessions spaced approximately one to two months apart (Median = `r sticsa.days.median` days; Range: `r sticsa.days.min`–`r sticsa.days.max` days).
In the initial session, an interviewer guided participants to identify and explore the fear they perceived as most impactful.
The second session replicated the procedure, focusing on the same proximal threat but involving a different interviewer to assess inter-rater reliability.
Each session lasted 30 to 90 minutes.
Between the two sessions, `r sticsa.dropoutN` participants (`r apa_percentage(sticsa.dropoutN/sticsa.N)`) withdrew from the study.
Participants were compensated with approximately \$10 per hour or course credit, depending on their preference.

### Measures

```{r include=FALSE}
raw.judges.sticsa = rbind(
  read_csv(here('data','CTSI.coding.sticsa.baraa.csv')) %>% mutate(id=1) %>% mutate(across(.cols = Affiliation:`No Idea`, ~str_replace_all(.x, "לא", NA_character_))),
  read_csv(here('data','CTSI.coding.sticsa.tomer.csv')) %>% mutate(id=2),
  read_csv(here('data','CTSI.coding.sticsa.yuval.csv')) %>% mutate(id=3)
) %>%
  filter(is.na(`No Idea`)) %>% # treat "no idea" as missing data
  filter(!if_all(Affiliation:`No Idea`, is.na)) # remove rows with no answer

jid = raw.judges.sticsa$id
uid = raw.judges.sticsa$rid %>% as.factor()
values = raw.judges.sticsa %>% select(-id, -rid) %>%as.matrix %>% apply(1,function(i){which(!is.na(i))})
sticsa.krip = krippendorff(jid = jid, uid = uid, values = values, agree = agree_fn)
```

The face-to-face CTSI was used to identify proximal and core threats, as outlined above.
Threats were scored by three judges who achieved good inter-rater reliability, with Krippendorff's $\alpha$ = `r sticsa.krip`.

**The Trait Inventory for Cognitive and Somatic Anxiety [TICSA\; @reeDistinguishingCognitiveSomatic2008]**
The TICSA is a validated 21-item self-report measure designed to assess cognitive and somatic dimensions of trait anxiety.
Each item is rated on a 4-point Likert scale, ranging from 0 ("not at all") to 3 ("very much so"), with higher scores reflecting greater severity of anxiety symptoms.
The TICSA has consistently demonstrated strong psychometric properties in diverse populations [@reeDistinguishingCognitiveSomatic2008; @grosPsychometricPropertiesStateTrait2007].
In the present study, the TICSA exhibited high internal consistency, with an omega coefficient of `r sticsa.sticsa.omega`.

## Methods: Experiment 3

Experiment 3 aimed to build on the findings from Experiment 2 by employing a self-administered version of the CTSI, facilitating a more scalable and participant-directed assessment of core and proximal threats.

### Participants and Procedure

Participants were recruited from a pre-existing database of individuals who had previously expressed interest in research participation and completed the TICSA.
Each participant was contacted by a research assistant, who obtained informed consent before enrollment.
Due to a technical error, participant age and gender data were not recorded.
However, given the similarity in recruitment procedures, the sample demographics are presumed to align closely with those of Experiment 2.
Full demographic information can be found in Table \@ref(tab:demographics).
Participants were provided with a secure link to complete the self-administered CTSI along with additional relevant questionnaires.
Participants were compensated with approximately \$10 per hour or course credit, depending on their preference.

### Measures

```{r include=FALSE}
raw.judges.online = rbind(
  read_csv(here('data','CTSI.coding.online.baraa.csv')) %>% mutate(id=1) %>% mutate(across(.cols = Affiliation:`No Idea`, ~str_replace_all(.x, "לא", NA_character_))),
  read_csv(here('data','CTSI.coding.online.tomer.csv')) %>% mutate(id=2),
  read_csv(here('data','CTSI.coding.online.yuval.csv')) %>% mutate(id=3)
) %>%
  filter(is.na(`No Idea`)) %>% # treat "no idea" as missing data
  filter(!if_all(Affiliation:`No Idea`, is.na)) # remove rows with no answer

jid = raw.judges.online$id
uid = raw.judges.online$rid %>% as.factor()
values = raw.judges.online %>% select(-id, -rid) %>%as.matrix %>% apply(1,function(i){which(!is.na(i))})
online.krip = krippendorff(jid = jid, uid = uid, values = values, agree = agree_fn)
```

The self-administered CTSI was used to identify proximal and core threats, as discussed above.
Three judges scored each threat and achieved good inter-rater reliability (Krippendorff's $\alpha$ = `r online.krip`).
The TICSA was used to measure anxiety, showing high internal consistency, with an omega coefficient of `r online.sticsa.omega`.

## Experiment 4

Experiment 4 aimed to expand upon Experiment 3 by recruiting an international, English-speaking population.

### Participants and Procedure

Participants were recruited via the Prolific platform for online research and compensated at a rate of £9 per hour.
Screening focused on identifying individuals with high anxiety, defined as a score greater than 4 on the Overall Anxiety Severity and Impairment Scale () [OASIS\;@normanDevelopmentValidationOverall2006], and functional impairment, indicated by at least one item scored above 2 on the Work and Social Adjustment Scale [WSAS; @mundtWorkSocialAdjustment2002].
Exclusion criteria included severe depression [PHQ score > 14\; @kroenkePHQ8MeasureCurrent2009], significant post-traumatic symptoms [short PCL-5 score > 6\; @zuromskiDevelopingOptimalShortform2019], or psychotic symptoms [items 19 or 20 on the DIAMOND screener\; @tolinPsychometricPropertiesStructured2018].
Additional criteria included fluency in English, no history of head injury or reading/writing difficulties (as indicated on the Prolific system), and experience on the platform with an approval rate above 95% and at least 300 prior submissions.
Eligible participants signed a consent form, completed a set of questionnaires related to a separate study, and then proceeded to the main experiment, which involved completing the self-administered CTSI.
Full demographic details can be found in Table \@ref(tab:demographics).

### Measures

```{r include=FALSE}
raw.judges.wet = rbind(
  read_csv(here('data','CTSI.coding.wet.baraa.csv')) %>% mutate(id=1),
  read_csv(here('data','CTSI.coding.wet.tomer.csv')) %>% mutate(id=2),
  read_csv(here('data','CTSI.coding.wet.yuval.csv')) %>% mutate(id=3)
) %>%
  filter(rid != 'rid') %>% # remove double header
  filter(is.na(`No Idea`)) %>% # treat "no idea" as missing data
  filter(!if_all(Affiliation:`No Idea`, is.na)) # remove rows with no answer

jid = raw.judges.wet$id
uid = raw.judges.wet$rid %>% as.factor()
values = raw.judges.wet %>% select(-id, -rid) %>%as.matrix %>% apply(1,function(i){which(!is.na(i))})
wet.krip = krippendorff(jid = jid, uid = uid, values = values, agree = agree_fn)
```

The self-administered CTSI was used to identify proximal and core threats, as discussed above. 
Three judges scored each threat, achieving good inter-rater reliability (Krippendorff's $\alpha$ = `r wet.krip`).

**The Overall Anxiety Severity and Impairment Scale [OASIS; @normanDevelopmentValidationOverall2006]** was used to measure anxiety.
This 5-item scale assesses the frequency, intensity, and impact of anxiety and fear over the past week, with responses ranging from 0 (Little or None) to 4 (Extreme or All the Time). 
Higher scores reflect greater severity, with a cut-off score of eight recommended for identifying anxiety disorders and a change of four points considered clinically significant [@moorePsychometricEvaluationOverall2015]. 
The OASIS demonstrated excellent reliability in this study, with an omega coefficient of `r wet.oasis.omega`, consistent with its strong psychometric properties reported in previous research [@normanDevelopmentValidationOverall2006].
